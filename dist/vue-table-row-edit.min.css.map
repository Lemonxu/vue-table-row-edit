{"version":3,"sources":["webpack:///./src/components/table/table.vue","webpack:///./src/components/table/table-row.vue"],"names":[],"mappings":"AAmMA,6BACA,YAEA,uBACA,sBACA,WACA,SACA,UACA,yBACA,iBACA,cAEA,0BACA,sBACA,YAGA,oDACA,aACA,kBACA,sBAGA,0BACA,yBACA,eACA,mBACA,yBAEA,wBACA,qBACA,cACA,mBACA,eACA,gBACA,yBACA,qBACA,cACA,wBACA,kBACA,sBACA,aACA,SACA,eACA,gBACA,sBACA,yBACA,qBACA,iBACA,eACA,kBAEA,kCACA,WACA,yBACA,qBAEA,kCACA,WACA,yBACA,qBAEA,iCACA,WACA,yBACA,qBAEA,kCACA,WACA,yBACA,qBClJA,wBACA,kBACA,qBAEA,0BACA,kBACA,yBAEA,+BACA,iBACA","file":"vue-table-row-edit.min.css","sourcesContent":["<template>\r\n    <section>\r\n        <table class=\"table-border table__header\">\r\n            <thead>\r\n                <tr>\r\n                    <th v-for=\"(head,index) in store.states.columns\" :key=\"index\" class=\"lemon-cell\">\r\n                        <label style=\"color:red\" v-if=\"isRequired(head)\">*</label>\r\n                        {{head.label}}\r\n                    </th>\r\n                    <th class=\"lemon-cell\" v-if=\"type==='edit'\">操作</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <slot :data=\"store\"></slot>\r\n                <tr v-for=\"(row,rowIndex) in store.states.data\" :key=\"rowIndex\" @click=\"handleCell(store.states,$event)\">\r\n                    <td v-for=\"(column,columnIndex) in store.states.columns\"  :key=\"columnIndex\" class=\"lemon-cell\" >\r\n                        <l-table-row :rowIndex=\"rowIndex\" :row=\"row\" :prop=\"column.prop\" :isEdit=\"getIsEdit(rowIndex)\" :rules=\"rules\" :rule=\"rules[column.prop]\" :column=\"column\" >\r\n                        </l-table-row>\r\n                    </td>\r\n                    <td class=\"lemon-cell\" v-if=\"type==='edit'\">\r\n                        <div>\r\n                            <button \r\n                            @click=\"handleEdit(rowIndex,row,$event)\" \r\n                            v-if=\"!getIsEdit(rowIndex)\" \r\n                            class=\"button--primary\">编辑</button>\r\n                            <button \r\n                            @click=\"handleDelete(rowIndex,row,$event)\" \r\n                            v-if=\"!getIsEdit(rowIndex)\"\r\n                            class=\"button--danger\">删除</button>\r\n                            <button \r\n                            @click=\"handleSuccess(rowIndex,row,$event)\" \r\n                            v-if=\"getIsEdit(rowIndex)\"\r\n                            class=\"button--success\">完成</button>\r\n                            <button \r\n                            @click=\"handleCancel(rowIndex,row,$event)\" \r\n                            v-if=\"getIsEdit(rowIndex)\"\r\n                            class=\"button--danger\">取消</button>\r\n                        </div>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n    </section>\r\n</template>\r\n\r\n<script>\r\nimport TableStore from './table-store'\r\nimport TableRow from './table-row.vue'\r\n\r\nArray.prototype.remove=function(value){\r\n    let index = this.indexOf(value);\r\n    if(index > -1)\r\n    this.splice(index,1)\r\n}\r\n\r\nconst columnStore={}  //在table和table-column进行交互传递\r\n\r\nexport default {\r\n    name:'LTable',\r\n    provide: {\r\n        LTable:columnStore\r\n    },\r\n    components:{\r\n        'l-table-row':TableRow\r\n    },\r\n    props:{\r\n        data:{\r\n            type:Array,\r\n            default:function(){\r\n                return []\r\n            }\r\n        },\r\n        type:{\r\n            type:String,\r\n            default:() => {\r\n                return 'default'\r\n            }\r\n        },\r\n        rules:{\r\n            type:Object,\r\n            default:function(){\r\n                return {}\r\n            }\r\n        }\r\n    },\r\n    data(){\r\n        const store = new TableStore(this,{\r\n            data:this.data,\r\n        })\r\n        return{\r\n            store,\r\n            editList:[],\r\n            validateMessage:'',\r\n        }\r\n    },\r\n    computed:{},\r\n    methods:{\r\n        isRequired(head){\r\n            let required=false;\r\n            let items=this.rules?this.rules[head.prop]:'';\r\n            let headType=items?(Array.isArray(items)?'array':'object'):'';\r\n            switch(headType){\r\n                case 'array':\r\n                if(items)\r\n                    items.map((item) => {\r\n                        if(item.required){\r\n                            required=true;\r\n                            return false;\r\n                        }\r\n                    })\r\n                break;\r\n                case 'object':\r\n                if(items.required) required=true;\r\n                break;\r\n                default:break;\r\n            }\r\n            return required\r\n        },\r\n        getIsEdit(rowIndex){\r\n            let editItem=this.editList.find((val) => { return val===rowIndex });\r\n            if(typeof editItem === 'undefined'){\r\n                return false\r\n            }\r\n            return true\r\n        },\r\n        handleSuccess(rowIndex,row,event){\r\n            let itemStates=[];\r\n            this.$emit('validator-'+rowIndex,(validateState) => {\r\n                itemStates.push(validateState);\r\n            });\r\n            let validateState=itemStates.find((item) => { return !item });\r\n            if(validateState==false){\r\n            }else{\r\n                this.$emit('success',row,(state) => {\r\n                    if(state){\r\n                        let editItem=this.editList.find((val) => { return val===rowIndex });\r\n                        if(editItem!=='undefined') this.editList.remove(editItem);\r\n                    }\r\n                    console.log(row,'完成')\r\n                });\r\n            }\r\n            event.cancelBubble=true;\r\n        },\r\n        handleCancel(rowIndex,row,event){\r\n            this.$emit('resetValidate-'+rowIndex)\r\n            let editItem=this.editList.find((val) => { return val===rowIndex });\r\n            if(editItem!=='undefined') this.editList.remove(editItem);\r\n        },\r\n        handleDelete(rowIndex,row,event){\r\n            this.$emit('delete',row,(state) => {\r\n                if(state){\r\n                    this.data.remove(row);\r\n                }\r\n                console.log(row,'删除成功')\r\n            });\r\n            event.cancelBubble=true;\r\n        },\r\n        handleEdit(rowIndex,row,event){\r\n            let editItem=this.editList.find((val) => { return val===rowIndex });\r\n            if(!editItem) this.editList.push(rowIndex)\r\n        },\r\n        //为列绑定当前行\r\n        handleCell(column,row,event){\r\n            this.$set(column,'value',row[column.prop]);\r\n        }\r\n    },\r\n    created(){\r\n        Object.assign(columnStore,this.store);\r\n    },\r\n    mounted(){\r\n        this.$parent.$on('validator',(callback) => {\r\n            let validatorStates=[];\r\n            this.editList.map((editItem) => {\r\n                let itemStates=[];\r\n                this.$emit('validator-'+editItem,(validateState) => {\r\n                    itemStates.push(validateState)\r\n                })\r\n                 let items=itemStates.find((item) => { return !item });\r\n                 if(items==false) validatorStates.push(false);\r\n                 else validatorStates.push(true);\r\n            });\r\n            let returnValidate=validatorStates.find((item) => { return !item });\r\n            if(returnValidate==false) callback(false)\r\n            else callback(true);\r\n        })\r\n        this.$parent.$on('resetValidate',(callback) => {\r\n            this.editList.map((editItem) => {\r\n                this.$emit('resetValidate-'+editItem)\r\n            })\r\n        })\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.lemon-cell{\r\n    height: 1rem;\r\n}\r\ntable {\r\n    border: 1px solid #ccc;\r\n    width: 100%;\r\n    margin:0;\r\n    padding:0;\r\n    border-collapse: collapse;\r\n    border-spacing: 0;\r\n    margin: 0 auto;\r\n  }\r\n   table tr {\r\n    border: 1px solid #ddd;\r\n    padding: 5px;\r\n  }\r\n\r\n  table th, table td {\r\n    padding: 10px;\r\n    text-align: center;\r\n    border: 1px solid #ddd;\r\n  }\r\n\r\n  table th {\r\n    text-transform: uppercase;\r\n    font-size: 14px;\r\n    letter-spacing: 1px;\r\n    background-color: #eef1f6;\r\n  }\r\nbutton{\r\n    display: inline-block;\r\n    line-height: 1;\r\n    white-space: nowrap;\r\n    cursor: pointer;\r\n    background: #fff;\r\n    border: 1px solid #dcdfe6;\r\n    border-color: #dcdfe6;\r\n    color: #606266;\r\n    -webkit-appearance: none;\r\n    text-align: center;\r\n    box-sizing: border-box;\r\n    outline: none;\r\n    margin: 0;\r\n    transition: .1s;\r\n    font-weight: 500;\r\n    -moz-user-select: none;\r\n    -webkit-user-select: none;\r\n    -ms-user-select: none;\r\n    padding: 5px 10px;\r\n    font-size: 14px;\r\n    border-radius: 4px;\r\n}\r\n.button--primary {\r\n    color: #fff;\r\n    background-color: #1885dd;\r\n    border-color: #1885dd;\r\n}\r\n.button--warning {\r\n    color: #fff;\r\n    background-color: #e6a23c;\r\n    border-color: #e6a23c;\r\n}\r\n.button--danger {\r\n    color: #fff;\r\n    background-color: #f56c6c;\r\n    border-color: #f56c6c;\r\n}\r\n.button--success {\r\n    color: #fff;\r\n    background-color: #67c23a;\r\n    border-color: #67c23a;\r\n}\r\n</style>\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/table/table.vue?9a92efec","<template>\r\n    <section>\r\n        <div  v-if=\"!isEdit\">\r\n            <label >{{row[prop]}}</label>\r\n        </div>\r\n        <div v-if=\"isEdit\" >\r\n            <slot :scope=\"row\"></slot>\r\n            <input \r\n            v-if=\"column.propType=='default'||column.propType=='input'\" \r\n            v-model=\"row[prop]\" \r\n            @change=\"validator\"\r\n            class=\"input_inline\"\r\n            :class=\"validateState==='error'?'error':'success'\"/>\r\n            <input \r\n            v-else-if=\"column.propType=='date'\" \r\n            type=\"date\" \r\n            v-model=\"row[prop]\"\r\n            class=\"input_inline\"\r\n            :class=\"validateState==='error'?'error':'success'\"/>\r\n            <el-input-number \r\n            v-else-if=\"column.propType=='number'\"  \r\n            v-model=\"row[prop]\"\r\n            :controls=\"false\"\r\n            size=\"mini\"\r\n            :class=\"validateState==='error'?'error':'success'\"></el-input-number>\r\n            <!-- <el-input \r\n            v-else-if=\"column.propType=='number'\"  \r\n            type=\"number\"  \r\n            v-model=\"row[prop]\" \r\n            class=\"input_inline\"\r\n            :class=\"validateState==='error'?'error':'success'\"></el-input> -->\r\n            <el-select\r\n            v-else-if=\"column.propType=='select'\"\r\n            v-model=\"row[prop]\" \r\n            size=\"mini\">\r\n                <el-option\r\n                v-for=\"item in column.options\"\r\n                :key=\"item.value\"\r\n                :label=\"item.label\"\r\n                :value=\"item.value\">\r\n                </el-option>\r\n            </el-select>\r\n            <br/>\r\n            <label style=\"color:red;font-size:smaller\">{{validateMessage}}</label>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script>\r\nimport AsyncValidator from 'async-validator';\r\n\r\n\r\nexport default {\r\n    name:'LTableRow',\r\n    props:{\r\n        row:[Object],\r\n        prop:[String],\r\n        isEdit:{\r\n            type:Boolean,\r\n            default:() => {\r\n                return false\r\n            }\r\n        },\r\n        column:{\r\n            type:Object,\r\n            default:() => {\r\n                return {};\r\n            }\r\n        },\r\n        rowIndex:[Number],\r\n        rules:{\r\n            type:Object,\r\n            default:() => {\r\n                return {}\r\n            }\r\n        },\r\n        rule:[Array,Object],\r\n    },\r\n    data(){\r\n        return{\r\n            validateMessage:\"\",\r\n            validateState:''\r\n        }\r\n    },\r\n    methods:{\r\n        validator(){\r\n            return new Promise((resolve, reject) => {\r\n                let validate = new AsyncValidator({[this.prop]:this.rule?this.rule:{}});\r\n                validate.validate({[this.prop]:this.row[this.prop]}, { firstFields: true }, (errors, fields) => {\r\n                    this.validateState = !errors ? 'success' : 'error';\r\n                    this.validateMessage = errors ? errors[0].message : '';\r\n                    this.$emit('message',this.validateMessage);\r\n                    this.$set(this.column,'message',this.validateMessage);\r\n                    resolve(errors)  \r\n                })  \r\n            })\r\n        },\r\n\r\n    },\r\n    mounted(){\r\n        this.$parent.$on('validator-'+this.rowIndex,(callback)=>{\r\n            this.validator();\r\n            if(this.validateState==\"success\"){\r\n                callback(true);\r\n            }else{\r\n                callback(false);\r\n            }\r\n        })\r\n        this.$parent.$on('resetValidate-'+this.rowIndex,(arr)=>{\r\n            this.validateState=\"\";\r\n            this.validateMessage=\"\";\r\n        })\r\n    },\r\n    created(){\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.error{\r\n    border-radius: 4px;\r\n    border: 1px solid red;\r\n}\r\n.success{\r\n    border-radius: 4px;\r\n    border: 1px solid #adb0b5;\r\n}\r\n.input_inline{\r\n    padding: 3px 10px;\r\n    display: inline-block;\r\n}\r\n</style>\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/table/table-row.vue?7c2d83a0"],"sourceRoot":""}